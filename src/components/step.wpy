<template>
    <view class="step">
        <view class="step-title">
            <text class="step-index">步骤{{index}}</text>
            <text class="step-name">{{stepData.stepName}}</text>
        </view>
        <view class="step-detail">
            <block wx:if="{{stepData.isObjective}}">
                <view class="option-group flex-box">
                    <repeat for="{{stepData.options}}" item="item" index="index2">
                        <view class="option-item {{item.isChecked ? 'checked': ''}}" data-opt-index="{{index2}}" @tap="toggle">
                            {{item.content}}
                        </view>
                    </repeat>
                </view>
            </block>
            <block wx:else>
                <view>
                    <text>{{stepData.detail}}</text>
                </view>
            </block>
        </view>
    </view>
</template>
<script>
    import wepy from 'wepy'

    export default class Step extends wepy.component {
        props = {
            index: {},
            stepData: {}
        }

        components = {

        }

        data = {}
        events = {

        }

        watch = {

        }

        methods = {
            toggle(e) {
                let toggleIndex = e.currentTarget.dataset.optIndex
                let index = this.stepData.options.findIndex((item, index) => {
                    return toggleIndex === index
                })
                this.stepData.options[index].isChecked = !this.stepData.options[index].isChecked
            }
        }

        onLoad() {
            console.log(this.stepData)
        }
    }
</script>
<style>
    .step {
        padding: 10rpx;
    }
    .step .step-title {
        padding: 10rpx;
    }
    .step .step-title .step-index {
        padding: 8rpx 20rpx;
        background: #1abcb0;
        color: #fff;
        position: relative;
        box-sizing: border-box;
        border-radius: 10rpx;
    }
    .step .step-title .step-index:after {
        position: absolute;
        right: -38rpx;
        top: 50%;
        transform: translate3d(0, -50%, 0);
        width: 1rpx;
        height: 1rpx;
        content: '\20';
        border-top: 12rpx solid transparent;
        border-left: 20rpx solid #1abcb0;
        border-right: 20rpx solid transparent;
        border-bottom: 12rpx solid transparent;
    }
    .step .step-title .step-name {
        color: #1abcb0;
        margin-left: 30rpx;
    }
    .step-detail {
        padding: 10rpx;
    }
    .option-item {
        color: #999;
        border: 1px solid #ccc;
        padding: 10rpx 20rpx;
        display: inline-block;
        margin-left: 10rpx;
        margin-top: 10rpx;
        min-width: 20vw;
        text-align: center;
        box-sizing: border-box;
    }
    .option-item.checked {
        border: 1px solid #f80;
        color: #f80;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAA3NCSVQICAjb4U/gAAAAIVBMVEX/kgH+6s//rT/////+x3/+lw//47/+pzD/u1//8eD/mRGn0WbrAAAACXBIWXMAAAsSAAALEgHS3X78AAAAFnRFWHRDcmVhdGlvbiBUaW1lADAzLzA2LzE4HZ4bUgAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAB2SURBVCiRXc6xDYMwGAXhv7Ei0VEkBWtc45YNIBNlFFJmS2RjMLlXnr7ixSe07IAJJphgggl38j7CRdKrhUpSxDq1UMm8pHE7QyHfZwVHKGQYK2ihkN8UPRTy2O6hf6GT/5AdLoIJJphgggkmmGCCCSaYYKKQdxNyQMxUNbqvAAAAAElFTkSuQmCC);
        background-position: right top;
        background-size: 30rpx 30rpx;
        background-repeat: no-repeat;
    }
    .option-group {
        flex-wrap: wrap;
        justify-content: flex-start;
        margin-left: -10rpx;
    }
</style>
