"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_step=require("./step.js"),_step2=_interopRequireDefault(_step),sy=void 0,my=void 0,isPrepareDragging=!1,StepList=function(e){function t(){var e,i,s,o;_classCallCheck(this,t);for(var n=arguments.length,r=Array(n),l=0;l<n;l++)r[l]=arguments[l];return i=s=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),s.props={list:{twoWay:!0},editable:{},parentScrollTop:{twoWay:!0}},s.$repeat={list:{com:"step",props:"stepData.sync"}},s.$props={step:{"xmlns:v-bind":{value:"",for:"list",item:"item",index:"index",key:"key"},"v-bind:stepData.sync":{value:"item",type:"item",for:"list",item:"item",index:"index",key:"key"},"v-bind:index.sync":{value:"index + 1",for:"list",item:"item",index:"index",key:"key"},"v-bind:editable.sync":{value:"editable",for:"list",item:"item",index:"index",key:"key"}}},s.$events={},s.components={step:_step2.default},s.data={offsetTopList:[],movingIndex:-1,offsetTop:0,opacity:1},s.events={},s.methods={onLongPress:function(e){this.editable&&(isPrepareDragging=!0,this.movingIndex=+e.currentTarget.dataset.index,this.$emit("disable-scroll"))},onStartTouch:function(e){this.editable&&(this.getOffsetTopList(),sy=e.touches[0].clientY)},onTouchMove:function(e){if(this.editable&&isPrepareDragging){my=e.touches[0].clientY;var t=my-sy;this.offsetTop+=t,sy=my}},onTouchEnd:function(e){if(this.editable&&isPrepareDragging){this.movingIndex=-1,this.offsetTop=0;var t=this.findStepItemIndex(e.currentTarget.offsetTop);this.rebuildList(e.currentTarget.dataset.index,t),this.$apply(),isPrepareDragging=!1,this.$emit("enable-scroll")}}},o=i,_possibleConstructorReturn(s,o)}return _inherits(t,e),_createClass(t,[{key:"getOffsetTopList",value:function(){var e=this,t=[],i=_wepy2.default.createSelectorQuery();i.selectAll(".step-item").boundingClientRect(),i.exec(function(i){i[0].forEach(function(i){t.push(i.top+(e.$parent.parentScrollTop||0))})}),this.offsetTopList=t}},{key:"findStepItemIndex",value:function(e){for(var t=0,i=0,s=this.offsetTopList.length;i<s;i++){if(e<=this.offsetTopList[i]){t=i-1;break}if(e>=this.offsetTopList[i]&&e<this.offsetTopList[i+1]){t=i+1;break}if(e>this.offsetTopList[s-1]){t=s;break}}return console.log("offset:",e),console.log(this.offsetTopList),console.log("index:",t),t=t<0?0:t}},{key:"rebuildList",value:function(e,t){if(console.log(e),console.log("newIndex",t),e!==t)if(e>t){var i=this.list[e];this.list.splice(e,1),this.list.splice(t,0,i)}else{var s=this.list[e];this.list.splice(e,1),this.list.splice(t,0,s)}}}]),t}(_wepy2.default.component);exports.default=StepList;