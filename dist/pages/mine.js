"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_personalTask=require("./../components/personal-task.js"),_personalTask2=_interopRequireDefault(_personalTask),_teacherCourseTask=require("./../components/teacher-course-task.js"),_teacherCourseTask2=_interopRequireDefault(_teacherCourseTask),_panel=require("./../components/panel.js"),_panel2=_interopRequireDefault(_panel),_richButton=require("./../components/rich-button.js"),_richButton2=_interopRequireDefault(_richButton),_api=require("./../api/index.js"),_util=require("./../util/index.js"),Mine=function(e){function t(){var e,n,a,s;_classCallCheck(this,t);for(var r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),a.config={navigationBarTitleText:"个性化学习中心",navigationBarBackgroundColor:"#02CDF9"},a.data={wxUserInfo:null,userName:"",userClass:"",isTeacher:!1,userTheme:"male",myTaskList:[],tRunningTasks:[],tCompleteTasks:[]},a.$repeat={commonTasks:{com:"personal-task2",props:"taskInfo.sync"},tRunningTasks:{com:"t-course-task1",props:"taskInfo.sync"},tCompleteTasks:{com:"t-course-task2",props:"taskInfo.sync"}},a.$props={"personal-task2":{class:{value:"task-comp",for:"commonTasks",item:"item",index:"index",key:"key"},"v-bind:theme.sync":{value:"userTheme",for:"commonTasks",item:"item",index:"index",key:"key"},"v-bind:taskInfo.sync":{value:"item",type:"item",for:"commonTasks",item:"item",index:"index",key:"key"}},"t-course-task1":{class:{value:"t-task-comp",for:"tRunningTasks",item:"item",index:"index",key:"key"},"v-bind:taskInfo.sync":{value:"item",type:"item",for:"tRunningTasks",item:"item",index:"index",key:"key"}},"t-course-task2":{class:{value:"t-task-comp",for:"tCompleteTasks",item:"item",index:"index",key:"key"},"v-bind:taskInfo.sync":{value:"item",type:"item",for:"tCompleteTasks",item:"item",index:"index",key:"key"}},"personal-task1":{class:"task-comp","xmlns:v-bind":"","v-bind:theme.sync":"userTheme","v-bind:taskInfo.sync":"runningTask","xmlns:v-on":""},"rich-button":{theme:"grey",text:"解除绑定"}},a.$events={"personal-task2":{"v-on:continue":"continueTask","v-on:restart":"restartTask","v-on:review":"reviewTask"},"t-course-task1":{"v-on:teacher-check-course":"checkCourse"},"t-course-task2":{"v-on:teacher-check-course":"reviewCourseGroup"},"personal-task1":{"v-on:continue":"continueTask","v-on:restart":"restartTask","v-on:review":"reviewTask"},"rich-button":{"v-on:tap":"onCancelRegister"}},a.components={"personal-task1":_personalTask2.default,"personal-task2":_personalTask2.default,"t-course-task1":_teacherCourseTask2.default,"t-course-task2":_teacherCourseTask2.default,panel:_panel2.default,"rich-button":_richButton2.default},a.watch={wxUserInfo:function(e,t){e?1===e.gender?this.userTheme="male":this.userTheme="female":this.userTheme="male",this.$apply()}},a.computed={runningTask:function(){return this.myTaskList?this.myTaskList.find(function(e){return 0===e.Status&&e.IsActivationGroup}):null},commonTasks:function(){return this.myTaskList?this.myTaskList.filter(function(e){return 0!==e.Status||!e.IsActivationGroup}):[]}},a.methods={continueTask:function(e){var t={CourseFID:e.CourseFID,GroupFID:e.FlnkID};_wepy2.default.setStorageSync("activeTaskInfo",t),_wepy2.default.switchTab({url:"/pages/practice"})},restartTask:function(e){var t=this,n=e.FlnkID,a={CourseFID:e.CourseFID,GroupFID:n};(0,_api.activateGroupTask)(this.$parent.globalData.userInfo.FlnkID,e.FlnkID,e.CourseFID).then(function(e){_wepy2.default.setStorageSync("activeTaskInfo",a),t.myTaskList.forEach(function(e){e.IsActivationGroup=e.FlnkID===n}),t.$apply()})},checkCourse:function(e){var t=e.FlnkID,n={CourseFID:e.CourseFID,GroupFID:t};(0,_api.activateGroupTask)(this.$parent.globalData.userInfo.FlnkID,e.FlnkID,e.CourseFID).then(function(e){_wepy2.default.setStorageSync("activeTaskInfo",n),_wepy2.default.switchTab({url:"/pages/practice"})})},reviewCourseGroup:function(e){_wepy2.default.navigateTo({url:"/practice/pages/reviewFinishTask?courseId="+e.CourseFID+"&groupId="+e.FlnkID})},reviewTask:function(e){_wepy2.default.navigateTo({url:"/practice/pages/reviewFinishTask?courseId="+e.CourseFID+"&groupId="+e.FlnkID})},onCancelRegister:function(){var e=this;_wepy2.default.showModal({title:"提示",content:"确定要解除绑定吗？解除绑定后，您需要重新绑定才能继续学习哦~",success:function(t){t.confirm&&(0,_api.cancelBind)(e.$parent.globalData.userInfo.FlnkID).then(function(e){_wepy2.default.redirectTo({url:"/pages/register"})})}})}},s=n,_possibleConstructorReturn(a,s)}return _inherits(t,e),_createClass(t,[{key:"init",value:function(){var e=this,t=this.$parent.globalData.userInfo.FlnkID;this.userName=this.$parent.globalData.userInfo.XM,this.isTeacher=this.$parent.globalData.userInfo.RoleNum+""=="2",this.isTeacher?this.initTeacherTasks(this.$parent.globalData.userInfo):((0,_api.getStuDetailInfo)(t).then(function(t){e.userClass=t.NJ+"年级（"+t.BJBH+"）班",e.$apply()}),(0,_api.getMyCourseTasks)(this.$parent.globalData.userInfo.SchoolFID,t).then(function(t){e.myTaskList=t||[],e.myTaskList.forEach(function(e){0===e.Status&&(e.lastDays=(0,_util.getLastDays)(e.CreateTime))}),e.$apply()}))}},{key:"initTeacherTasks",value:function(e){var t=this;(0,_api.getMyCourseTasks)(e.SchoolFID,e.FlnkID).then(function(e){var n=e||[];n.forEach(function(e){0===e.Status&&(e.lastDays=(0,_util.getLastDays)(e.CreateTime))}),t.tCompleteTasks=n.filter(function(e){return 0!==e.Status}),t.tRunningTasks=n.filter(function(e){return 0===e.Status}),t.$apply()})}},{key:"onShow",value:function(){this.wxUserInfo=this.$parent.globalData.wxUserInfo,1===this.wxUserInfo.gender?_wepy2.default.setNavigationBarColor({backgroundColor:"#02CDF9",frontColor:"#ffffff"}):_wepy2.default.setNavigationBarColor({backgroundColor:"#FF7D7D",frontColor:"#ffffff"}),this.init()}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Mine,"pages/mine"));