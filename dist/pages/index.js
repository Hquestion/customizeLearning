"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,o,s){return o&&e(t.prototype,o),s&&e(t,s),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_courseTask=require("./../components/course-task.js"),_courseTask2=_interopRequireDefault(_courseTask),_course=require("./../components/course.js"),_course2=_interopRequireDefault(_course),_emptyContent=require("./../components/empty-content.js"),_emptyContent2=_interopRequireDefault(_emptyContent),_api=require("./../api/index.js"),Home=function(e){function t(){var e,o,s,r;_classCallCheck(this,t);for(var a=arguments.length,n=Array(a),u=0;u<a;u++)n[u]=arguments[u];return o=s=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),s.config={navigationBarTitleText:"个性化学习中心"},s.$repeat={schoolCourseTasks:{com:"course-task",props:"taskInfo.sync"},classCourseTasks:{com:"course-task",props:"taskInfo.sync"},cateCourseList:{com:"course",props:"course"}},s.$props={"course-task":{class:{value:"course-task-item",for:"classCourseTasks",item:"item",index:"index",key:"key"},"xmlns:v-bind":{value:"",for:"schoolCourseTasks",item:"item",index:"index",key:"key"},"v-bind:taskInfo.sync":{value:"item",type:"item",for:"classCourseTasks",item:"item",index:"index",key:"key"},"xmlns:v-on":{value:"",for:"schoolCourseTasks",item:"item",index:"index",key:"key"}},course:{class:{value:"course-item",for:"cateCourseList",item:"item",index:"index",key:"key"},"v-bind:course.once":{value:"item",type:"item",for:"cateCourseList",item:"item",index:"index",key:"key"}}},s.$events={"course-task":{"v-on:toggle-praise":"onTogglePraise"}},s.components={"course-task":_courseTask2.default,course:_course2.default,"empty-content":_emptyContent2.default},s.data={userInfo:null,userLocalInfo:null,classCourseTaskLoaded:!1,currentTabIndex:0,schoolCourseTasks:[],classCourseTasks:[],courseCategories:[],activeCateId:"",cateCourseList:[],userInfoDetail:null},s.computed={schoolId:function(){return this.$parent.globalData.userInfo&&this.$parent.globalData.userInfo.SchoolFID}},s.methods={setCurrentTab:function(e){this.currentTabIndex=e},onSwiperChange:function(e){this.currentTabIndex=e.detail.current,this.handleSwiperChange(e.detail.current)},navigateToDetail:function(e){var t=e.FlnkID;_wepy2.default.navigateTo({url:"/course/pages/course-detail?courseId="+t})},navigateToTaskDetail:function(e){_wepy2.default.navigateTo({url:"/practice/pages/reviewFinishTask?courseId="+e.CourseFID+"&groupId="+e.FlnkID})},changeCategory:function(e){this.activeCateId=e.cateid,this.$apply(),this.getCoursesByCategory(e.cateid)},onTogglePraise:function(e){var t=this,o="";o=0===this.currentTabIndex?"schoolCourseTasks":"classCourseTasks";var s=e.FlnkID;e.IsPraise?(0,_api.userCancelPraise)(this.userLocalInfo.FlnkID,s,e.CourseFID).then(function(e){var r=t[o].find(function(e){return s===e.FlnkID});r&&(r.IsPraise=!1,r.PraiseNum--,t.$apply())}):(0,_api.userPraise)(this.userLocalInfo.FlnkID,s,e.CourseFID).then(function(e){var r=t[o].find(function(e){return s===e.FlnkID});r&&(r.IsPraise=!0,r.PraiseNum++,t.$apply())})}},r=o,_possibleConstructorReturn(s,r)}return _inherits(t,e),_createClass(t,[{key:"handleSwiperChange",value:function(e){var t=this;1===e?this.classCourseTaskLoaded||(0,_api.getStuDetailInfo)(this.userLocalInfo.FlnkID).then(function(e){t.getCourseTaskOrder(t.userLocalInfo.SchoolFID,t.userLocalInfo.FlnkID,{LevelNum:e.LevelNum,GradeNum:e.GradeNum,ClassNum:e.ClassNum}).then(function(e){t.classCourseTasks=e.DataSource||[],t.classCourseTasks.forEach(function(e){e.order=e.ClassSortCode||e.SchoolSortCode}),t.$apply(),t.classCourseTaskLoaded=!0},function(){t.classCourseTasks=[],t.$apply(),t.classCourseTaskLoaded=!0})}):2===e&&(this.courseCateLoaded||this.getCourseCategory())}},{key:"getCourseCategory",value:function(){var e=this;(0,_api.getCourseCateBySchool)(this.userLocalInfo.SchoolFID).then(function(t){e.courseCategories=t.ResultObj.map(function(e){return{cateid:e.CourseCategoryFID,cateName:e.CourseCategoryName}}),e.activeCateId=e.courseCategories[0].cateid,e.$apply(),e.getCoursesByCategory(e.activeCateId),e.courseCateLoaded=!0})}},{key:"getCoursesByCategory",value:function(e){var t=this;(0,_api.getCoursesByCategory)(e,this.userLocalInfo.SchoolFID).then(function(e){t.cateCourseList=e,t.$apply()})}},{key:"getCourseTaskOrder",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(s,r){(0,_api.getCourseTaskOrderList)(e,t,o.LevelNum,o.GradeNum,o.ClassNum).then(function(e){s(e.ResultObj)},r)})}},{key:"init",value:function(){var e=this;(0,_api.login)().then(function(t){t.FlnkID?(e.$parent.globalData.userInfo=t,e.loadPageData()):_wepy2.default.redirectTo({url:"/pages/register?openid="+t.WechatAccount})},function(e){_wepy2.default.showToast({title:"登陆失败",icon:"none"})})}},{key:"loadPageData",value:function(){var e=this;this.userLocalInfo=this.$parent.globalData.userInfo,this.getCourseTaskOrder(this.userLocalInfo.SchoolFID,this.userLocalInfo.FlnkID).then(function(t){e.schoolCourseTasks=t.DataSource||[],e.schoolCourseTasks.forEach(function(e){e.order=e.SchoolSortCode}),e.$apply()},function(){e.schoolCourseTasks=[],e.$apply()}),(0,_api.getCurrentActivateTask)(this.userLocalInfo.FlnkID).then(function(e){var t={CourseFID:e.CourseFID,GroupFID:e.GroupFID};_wepy2.default.setStorageSync("activeTaskInfo",t)},function(){_wepy2.default.removeStorageSync("activeTaskInfo")})}},{key:"onLoad",value:function(){var e=this;this.$parent.getUserInfo(function(t){e.userInfo=t,e.$apply()}),e.init()}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Home,"pages/index"));